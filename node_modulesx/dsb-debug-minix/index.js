module.exports = (function(){
/*---------------------------------------------------------------------*/

  //dsb-chalk is part of a larger software
  //var chalk = require('dsb-chalk');
  var chalk = require('chalk');
  //var compare = require('dsb-compare');
  //var toArray = require('dsb-to-array');
  var type = require('dsb-typecheck');
  
/***********************************************************************/

  /*
   * @module debug-mini
   * creates a miniture debugger, independent of dsb-debug, that
   * can be used in situations where dsb-debug would cause conflict
   * (mainly modules required by dsb-debug, preventing cyclical deps)
   */

/*---------------------------------------------------------------------*/

  var debug = {
    fail: [],
    pass: 0,
    all: 0,
    test: function( n, r, e ){
      this.all++;
      //var x = compare(r,e);
      var x = ( r === e );
      if( x ) this.pass++;
      else this.fail.push( n );
      var v = '['+(x ? 'pass' : 'fail')+']';
      var c = (x?'green':'red');
      v = chalk.bold[c]( v );
      console.log( '\n', v, n, '\n' );
    },
    method: function( name, fn, src ){
      
      var DMR = function(x, i){
        return 'debug.method requires '+x+' as '+i+' parameter';
      };
      var SRC = 'a source method (or object with name as matching key to a method)';
      
      if( !type( name, 'string' ) )
          throw new Error( DMR( 'a name', '1st' ) );

      if( !type( fn, 'function' ) )
        throw new Error( DMR( 'a test_callback', '2nd' ) );

      var sfn = type( fn, 'function' );

      if( !sfn && !type( src, 'object' ) )
        throw new Error( DMR( SRC, '3nd' ) );        

      var _fn;
      if( sfn ) _fn = src;
      else {
        if( type( src[name], 'function' ) ) _fn = src[name];
        else throw new Error( DMR( SRC, '3nd' ) );        
      } 
      
      var self = this;
      var _test = function( n, a, e ){
        var ns = type( n, 'string' );            
        if( !ns ){ e = a; a = n; n = name; }
        var aa = type( a, 'array' );
        if( !aa ) a = [a];
        if( ns ) n += '('+a.join(', ')+')';
        var r = _fn.apply( null, a );
        return self.test( n, r, e );        
      };
      
      return fn( _fn, _test, name );
      
    },
    question: function(q,a){ 
      console.log( q, ( a ? 'yes' : 'no' ) );
    },
    complete: function(){
      var p = ( this.pass === this.all );
      console.log( p ? 'ALL TESTS PASSED' : 'something failed...'+this.fail);
    },
    name: 'generic debug-mini',
    create: function(name){
      if( typeof name === 'string' ) this.name = name;
      return this;
    }
  };
 
/*---------------------------------------------------------------------*/

  return debug;

/*---------------------------------------------------------------------*/  
}());